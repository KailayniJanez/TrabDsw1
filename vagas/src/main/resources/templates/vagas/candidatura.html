<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{vacancy.applications.title}">Candidaturas para Vaga</title> <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#" th:text="#{company.vacancies.index.navbar.link}">Vagas</a> </div>
    </nav>

    <div class="container mt-4">
        <div class="card">
            <div class="card-header">
                <h2>
                    <span th:text="#{vacancy.applications.card.title}">Candidaturas para a Vaga:</span> <span th:text="${vaga.descricao}">[Descrição da Vaga]</span>
                </h2>
                <p class="mb-0"><span th:text="#{vacancy.applications.card.city}">Cidade:</span> <span th:text="${vaga.cidade}">[Cidade]</span></p> <p class="mb-0"><span th:text="#{vacancy.applications.card.salary}">Remuneração:</span> <span th:text="${vaga.remuneracao}">[Remuneração]</span></p> <p class="mb-0"><span th:text="#{vacancy.applications.card.deadline}">Data Limite de Inscrição:</span> <span th:text="${#temporals.format(vaga.dataLimiteInscricao, 'dd/MM/yyyy')}">[Data]</span></p> <a th:href="@{/vagas/index}" class="btn btn-secondary btn-sm mt-2" th:text="#{vacancy.applications.back_to_my_vacancies}">Voltar para Minhas Vagas</a> </div>
            <div class="card-body">
                <div th:if="${successMessage}" class="alert alert-success mt-3" th:text="${successMessage}"></div>
                <div th:if="${errorMessage}" class="alert alert-danger mt-3" th:text="${errorMessage}"></div>

                <h3 class="mt-4" th:text="#{vacancy.applications.list.title}">Lista de Candidatos</h3> <div th:if="${#lists.isEmpty(candidaturas)}" class="alert alert-info" th:text="#{vacancy.applications.list.empty}"> Nenhum candidato se inscreveu para esta vaga ainda.
                </div>
                <table th:if="${!#lists.isEmpty(candidaturas)}" class="table table-striped mt-3">
                    <thead>
                        <tr>
                            <th th:text="#{vacancy.applications.table.header.professional}">Profissional</th> <th th:text="#{vacancy.applications.table.header.email}">Email</th> <th th:text="#{vacancy.applications.table.header.message}">Mensagem</th> <th th:text="#{vacancy.applications.table.header.current_status}">Status Atual</th> <th th:text="#{vacancy.applications.table.header.interview_date}">Data Entrevista</th> <th th:text="#{vacancy.applications.table.header.interview_link}">Link Entrevista</th> <th th:text="#{vacancy.applications.table.header.resume}">Currículo</th> <th th:text="#{vacancy.applications.table.header.actions}">Ações</th> </tr>
                    </thead>
                    <tbody>
                        <tr th:each="candidatura : ${candidaturas}">
                            <td th:text="${candidatura.profissional.nome}">[Nome do Profissional]</td>
                            <td th:text="${candidatura.profissional.email}">[Email do Profissional]</td>
                            <td th:text="${candidatura.mensagem}">[Mensagem do Candidato]</td>
                            <td>
                                <span th:text="${candidatura.status == T(com.example.vagas.model.StatusCandidatura).ABERTO} ? #{application.status.open} :
                                              (${candidatura.status == T(com.example.vagas.model.StatusCandidatura).ENTREVISTA} ? #{application.status.interview} :
                                              #{application.status.not_selected})"></span> </td>
                            <td>
                                <span th:if="${candidatura.dataEntrevista}" th:text="${#temporals.format(candidatura.dataEntrevista, 'dd/MM/yyyy HH:mm')}"></span>
                                <span th:unless="${candidatura.dataEntrevista}" th:text="#{not.available}">N/A</span> </td>
                            <td>
                                <a th:if="${candidatura.linkEntrevista}" th:href="${candidatura.linkEntrevista}" target="_blank" th:text="${candidatura.linkEntrevista}">Link</a>
                                <span th:unless="${candidatura.linkEntrevista}" th:text="#{not.available}">N/A</span> </td>
                            <td>
                                <a th:if="${candidatura.curriculoNome}" th:href="@{/candidaturas/download-curriculo/{id}(id=${candidatura.id})}" target="_blank" th:text="#{download.resume}">Download Currículo</a> <span th:unless="${candidatura.curriculoNome}" th:text="#{not.available}">N/A</span> </td>
                            <td>
                                <form th:action="@{/vagas/__${vaga.id}__/candidaturas/__${candidatura.id}__/atualizar-status}" method="post" class="status-form">
                                    <div class="mb-2">
                                        <label for="novoStatus" class="form-label visually-hidden" th:text="#{status.label}">Status</label> <select name="novoStatus" class="form-select status-select">
                                            <option value="ABERTO" th:selected="${candidatura.status == T(com.example.vagas.model.StatusCandidatura).ABERTO}" th:text="#{application.status.open}">ABERTO</option> <option value="ENTREVISTA" th:selected="${candidatura.status == T(com.example.vagas.model.StatusCandidatura).ENTREVISTA}" th:text="#{application.status.interview}">ENTREVISTA</option> <option value="NAO_SELECIONADO" th:selected="${candidatura.status == T(com.example.vagas.model.StatusCandidatura).NAO_SELECIONADO}" th:text="#{application.status.not_selected}">NÃO SELECIONADO</option> </select>
                                    </div>
                                    <div class="interview-fields" style="display: none;">
                                        <div class="mb-2">
                                            <label for="dataEntrevista" class="form-label" th:text="#{interview.date.label}">Data Entrevista:</label> <input type="date" name="dataEntrevista" class="form-control form-control-sm" th:value="${candidatura.dataEntrevista != null ? #temporals.format(candidatura.dataEntrevista, 'yyyy-MM-dd') : ''}" />
                                        </div>
                                         <div class="mb-2">
                                            <label for="horaEntrevista" class="form-label" th:text="#{interview.time.label}">Hora Entrevista:</label> <input type="time" name="horaEntrevista" class="form-control form-control-sm" th:value="${candidatura.dataEntrevista != null ? #temporals.format(candidatura.dataEntrevista, 'HH:mm') : ''}" />
                                        </div>
                                        <div class="mb-2">
                                            <label for="linkEntrevista" class="form-label" th:text="#{interview.link.label}">Link Entrevista:</label> <input type="text" name="linkEntrevista" class="form-control form-control-sm" th:placeholder="#{interview.link.placeholder}" th:value="${candidatura.linkEntrevista}" /> </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-sm mt-2" th:text="#{action.update}">Atualizar</button> </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const statusSelects = document.querySelectorAll('.status-select');

            statusSelects.forEach(select => {
                const form = select.closest('form');
                const interviewFields = form.querySelector('.interview-fields');

                function toggleInterviewFields() {
                    if (select.value === 'ENTREVISTA') {
                        interviewFields.style.display = 'block';
                    } else {
                        interviewFields.style.display = 'none';
                    }
                }

                toggleInterviewFields();
                select.addEventListener('change', toggleInterviewFields);
            });
        });
    </script>

</body>
</html>